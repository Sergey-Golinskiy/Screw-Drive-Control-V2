работает, отлично. теперь давай продумаем архитектуру. у меня есть 4 таких геркона, которые нужно будет отслеживать в определенный момент времени понему будет выполнятся действие, так же у меня есть  модуль реле на 8 реле, с 8 входами управления, к которым убудет подключаться котушки. давай сделаем условное обозначение

Реле 1 - R01_PIT - Питатель Винтов -  он по фактту замыкает два провода между собой и отпускает, винт полетел 
Реле 2 - R02_C1_UP - Распределитель для подйома основного цилиндра - Когда он замыкается цилиндер подымаеться. в этот момент R03_C1_DOWN должен быть выключен.
Реле 3 - R03_C1_DOWN - Распределитель для опускания основного цилиндра - Когда он замыкается цилиндр опускается. в этот момент R03_C1_UP должен быть выключен.
Реле 4 - R04_C2 - Распределитель для опускания/подымания цилиндра отвертки - Когда он замыкаеться отвертка един в низ, когда размыкается, автоматически вверх
Реле 5 - R05_DI4_FREE - Замыкает вход на ноль и крутиться отвертка пока замкнуто реле, размыкаем реле отвертка останавливаеться.
Реле 6 - R06_DI1_POT - Замыкаем и держим реле, Отвертка крутиться пока не достигнет нужного момента, когда момент достигнут, мы получаем ответ ОК от датчика, который будет подключен позже
Реле 7 - R07_DI5_TSK0 - Выбор нужной таски для закручивания. нужно сделать импульс на реле на 700 милисекунд
Реле 8 - R08 - пока свободно.

Еде у нас есть датчики, тоесть герконы. Которые по факту являються сухими контактами, и когда они замкнуты означает что сенсор сработал CLOSE, когда разомкнуты OPEN
GER_C1_UP - Сенсор крайнего положения ВЕРХ Основного цилиндра
GER_C1_DOWN -  Сенсор крайнего положения НИЗ Основного цилиндра
GER_C2_UP - Сенсор крайнего положения ВЕРХ цилиндра отвертки
GER_C2_DOWN - Сенсор крайнего положения НИЗ цилиндра отвертки
IND_SCRW - Индуктивный сенсор для отслеживания прошел ли винт через трубку или нет. подключен он к жпио12. OPEN - Винта нет, 	CLOSE - винт прошел
DO2_OK - Ответ от драйвера что винт закручен с нудным моментом. OPEN - не ок, момент еще не достигнут	CLOSE - момент достигнут
PED_START - По факту педалька, которая управляет запуском последовательности OPEN - педалька отпущена, CLOSE - педалька нажата


Позже я распишу какой код нужно написать, для работы в цикле и логику что за чем срабатывает. сейчас нам нужно написать основной код, для управления, к которому мы потом будем обращаться для програмы работы в цикле. так же опиши что куда подключить



1. Запускается скрипт
2. Проверяем GER_C1_UP, если CLOSE ничего не делаем, если OPEN, включаем R02_C1_UP и ждем пока GER_C1_UP станет CLOSE.
2.1 Включаем R04_C2 и держим включенным пока GER_C2_DOWN не станет CLOSE
2.2 Выключаем R04_C2 и ждем пока GER_C2_UP станет CLOSE.
3. Даем импульс (50милисикунд) на R01_PIT
4. Включаем R03_C1_DOWN и держим включённым пока GER_C1_DOWN не станет CLOSE.
5. Включаем R04_C2 и держим включенным пока GER_C2_DOWN не станет CLOSE
6. Выключаем R04_C2 и ждем пока GER_C2_UP станет CLOSE.
7. Включаем R02_C1_UP и ждем пока GER_C1_UP станет  CLOSE.
8. Повторяем с пункта 2




1. Запускается скрипт
2. Проверяем GER_C1_UP, если CLOSE ничего не делаем, если OPEN, включаем R02_C1_UP и ждем пока GER_C1_UP станет CLOSE.
3. Включаем R04_C2 и держим включенным пока GER_C2_DOWN не станет CLOSE
4. Выключаем R04_C2 и ждем пока GER_C2_UP станет CLOSE.
5. Ждем нажатия педальки PED_START - первое нажатие педальки в этом цикле
6. Включаем R03_C1_DOWN и держим включённым пока GER_C1_DOWN не станет CLOSE.
7. Ждем нажатия педальки PED_START - второе нажатие педальки в этом цикле
8. Даем импульс (500милисикунд) на R01_PIT
8.1 ждем 300 милисикунд, что IND_SCRW измениться на CLOSE хотя бы импульсно, если не изменился, делаем еще раз пункт 8 
9. Включаем R06_DI1_POT
10. Включаем R04_C2 и держим включенным пока DO2_OK не станет CLOSE
11. Выключаем R04_C2 и R06_DI1_POT и ждем пока GER_C2_UP станет CLOSE.
11.1 Включить R05_DI4_FREE на 100 милисикунд и выключить
12. Включаем R02_C1_UP и ждем пока GER_C1_UP станет  CLOSE.
13. Повторяем с пункта 5


1. Запускается скрипт
2. Открываем сериал порт и держим открытым пока скрипт работает
2.1 Ждем пока порт откроеться  и мы получем овтет от ардуино "ok READY"
3. Отправляем в сериал команду "G28", ждем ок
4. Проверяем GER_C1_UP, если CLOSE ничего не делаем, если OPEN, включаем R02_C1_UP и ждем пока GER_C1_UP станет CLOSE.
5. Включаем R04_C2 и держим включенным пока GER_C2_DOWN не станет CLOSE
6. Выключаем R04_C2 и ждем пока GER_C2_UP станет CLOSE.
7. Ждем нажатия педальки PED_START
8. Отправляем в сериал команду "G X35 Y155 F30000", Ждем ок
9. Даем импульс (500милисикунд) на R01_PIT
10. ждем 300 милисикунд, что IND_SCRW измениться на CLOSE хотя бы импульсно, если не изменился, делаем еще раз пункт 9 
11. Включаем R06_DI1_POT
12. Включаем R04_C2 и держим включенным пока DO2_OK не станет CLOSE
13. Выключаем R04_C2 и R06_DI1_POT и ждем пока GER_C2_UP станет CLOSE.
14. Включить R05_DI4_FREE на 100 милисикунд и выключить
15. Отправляем в сериал команду "G X15 Y123 F30000", Ждем ок
16. Даем импульс (500милисикунд) на R01_PIT
17. ждем 300 милисикунд, что IND_SCRW измениться на CLOSE хотя бы импульсно, если не изменился, делаем еще раз пункт 9 
18. Включаем R06_DI1_POT
19. Включаем R04_C2 и держим включенным пока DO2_OK не станет CLOSE
20. Выключаем R04_C2 и R06_DI1_POT и ждем пока GER_C2_UP станет CLOSE.
21. Включить R05_DI4_FREE на 100 милисикунд и выключить
22. Отправляем в сериал команду "G X54 Y123 F30000", Ждем ок
23. Даем импульс (500милисикунд) на R01_PIT
24. ждем 300 милисикунд, что IND_SCRW измениться на CLOSE хотя бы импульсно, если не изменился, делаем еще раз пункт 9 
25. Включаем R06_DI1_POT
26. Включаем R04_C2 и держим включенным пока DO2_OK не станет CLOSE
27. Выключаем R04_C2 и R06_DI1_POT и ждем пока GER_C2_UP станет CLOSE.
28. Включить R05_DI4_FREE на 100 милисикунд и выключить
28.1 Отправляем в сериал команду "G X35 Y20 F30000", Ждем ок
29. Повторяем с пункта 7



